# 9.3 命令歷史

Claude Code 提供了強大的命令歷史功能，讓您可以輕鬆重用、搜尋和管理之前的輸入。命令歷史按工作目錄獨立儲存，確保您在不同專案中保持清晰的工作流。

## 核心特性


  * **按目錄儲存** ：每個專案目錄有獨立的命令歷史記錄
  * **持久化儲存** ：歷史記錄會自動儲存，重啟會話後依然可用
  * **快速導航** ：使用箭頭鍵快速瀏覽歷史命令
  * **智慧搜尋** ：支援反向搜尋和模糊匹配
  * **歷史擴充套件** ：預設禁用，可根據需要啟用
  * **清除功能** ：可以清除當前會話的所有歷史記錄

## 导航命令历史

### 1\. 使用箭头键


最基本的導航方式是使用上下箭頭鍵：

```
    bash


    # 按 ↑ 向上导航到之前的命令
    git status
    [按 ↑]  # 显示之前执行的 git status 命令

    # 按 ↓ 向下导航到较新的命令
    git status
    [按 ↓]  # 返回到空输入或下一个命令

### 2\. 使用 Ctrl+R 反向搜索


`Ctrl+R` 是最強大的命令歷史搜尋工具，允許您互動式搜尋之前的命令：

#### 使用步驟

  1. **啟用搜尋** ：按 `Ctrl+R` 啟用反向歷史搜尋
  2. **輸入查詢** ：輸入關鍵詞以在歷史命令中搜尋
  3. **瀏覽匹配** ：再次按 `Ctrl+R` 迴圈瀏覽更早的匹配項
  4. **接受結果** ：

     * 按 `Tab` 或 `Esc` 接受当前匹配并继续编辑
     * 按 `Enter` 接受并立即执行命令

```

  5. **取消搜尋** ：

```
     * 按 `Ctrl+C` 取消并恢复原始输入
     * 在空搜索上按 `Backspace` 取消

#### 搜索示例

    bash


    # 按 Ctrl+R 开始搜索
    (reverse-i-search)`git': git commit -m "fix bug"

    # 继续输入搜索词以缩小范围
    (reverse-i-search)`git commit': git commit -m "add new feature"

    # 按 Ctrl+R 查看更早的匹配
    (reverse-i-search)`git commit': git commit -m "initial commit"

### 3\. 其他导航方式


  * `Ctrl+P`：等同於向上箭頭，顯示上一個命令
  * `Ctrl+N`：等同於向下箭頭，顯示下一個命令
  * `Alt+.`：插入上一個命令的最後一個引數

## 管理命令历史

### 清除当前会话历史

```

使用 `/clear` 命令清除當前會話的所有命令歷史：

```
    bash


    /clear

### 清除特定命令

```

Claude Code 不支援直接刪除特定命令，但您可以透過以下方式間接實現：

  1. 使用 `/clear` 清除所有歷史記錄
  2. 重新開始會話
  3. 或者，忽略不需要的命令，繼續使用歷史功能

### 歷史記錄儲存

命令歷史按工作目錄儲存，這意味著：

  * 每個專案目錄有獨立的歷史記錄
  * 切換目錄會自動載入該目錄的歷史記錄
  * 歷史記錄持久化儲存，不會隨會話結束而丟失

#### 歷史檔案位置

歷史檔案通常儲存在使用者主目錄的 `.claude` 資料夾中：

```
    bash


    ~/.claude/history/

## 使用场景

### 1\. 重用之前的命令

```

當您需要重複執行相同或相似的命令時，命令歷史可以節省大量時間：

```
    bash


    # 之前执行的命令
    npm install --save-dev jest

    # 使用箭头键快速重用
    [按 ↑]  # 显示 npm install --save-dev jest
    [按 Enter]  # 执行该命令

### 2\. 搜索特定命令

```

當您需要找到之前執行過的特定命令時，反向搜尋非常有用：

```
    bash


    # 搜索包含 "test" 的命令
    (reverse-i-search)`test': npm test -- --coverage

    # 搜索包含 "build" 的命令
    (reverse-i-search)`build': npm run build

### 3\. 修改之前的命令

```

您可以找到之前的命令並進行修改，而無需重新輸入整個命令：

```
    bash


    # 找到之前的部署命令
    (reverse-i-search)`deploy': npm run deploy -- --env=production

    # 修改环境参数
    npm run deploy -- --env=staging  # 直接编辑后执行

### 4\. 学习和回顾

```

命令歷史還可以幫助您回顧之前的工作，學習自己的工作模式：

```
    bash


    # 查看最近执行的命令历史
    history  # 显示命令历史列表

## 最佳实践

```

  1. **使用有意義的命令** ：在輸入命令時，儘量使用清晰的描述，便於後續搜尋
  2. **定期清理** ：對於不再需要的歷史記錄，使用 `/clear` 命令清理
  3. **利用反向搜尋** ：`Ctrl+R` 是提高工作效率的關鍵工具，熟練掌握它
  4. **注意隱私** ：避免在命令歷史中輸入敏感資訊，如密碼或金鑰
  5. **跨專案工作** ：利用按目錄儲存的特性，在不同專案中保持獨立的命令歷史

## 故障排除

### 命令历史不显示


  * 確保您在正確的工作目錄中
  * 檢查歷史檔案許可權是否正確
  * 嘗試重啟 Claude Code 會話

### 反向搜尋不工作


  * 確保沒有其他程式佔用 `Ctrl+R` 快捷鍵
  * 檢查終端的快捷鍵設定
  * 嘗試使用 `Ctrl+P` 和 `Ctrl+N` 作為替代

### 歷史記錄丟失


  * 檢查歷史檔案是否存在：`~/.claude/history/`
  * 確保有足夠的磁碟空間
  * 檢查檔案系統許可權

### 歷史擴充套件功能

歷史擴充套件 (`!`) 預設禁用，如果需要啟用，可以透過配置檔案進行設定。但請注意，歷史擴充套件可能會帶來安全風險，建議謹慎使用。
