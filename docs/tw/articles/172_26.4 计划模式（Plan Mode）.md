# 26.4 計劃模式（Plan Mode）

## Plan Mode概述

Plan Mode（計劃模式）是Claude Code中的一項高階智慧規劃功能，依託Anthropic最新的Claude Opus 4.5模型的強大規劃能力，透過在執行任何程式碼修改之前生成詳細的執行計劃，顯著提高了程式設計任務的可靠性和可預測性。這一功能將傳統的"直接執行"模式轉變為"計劃-稽核-執行"的閉環工作流程，為使用者提供了可編輯、可稽核的任務執行藍圖。

## Plan Mode的核心概念

### 1\. 什么是Plan Mode


Plan Mode是Claude Code的三種作業模式之一（預設模式、計劃模式、自動接受模式），具有以下核心特點：

  * **先計劃後執行** ：在執行任何程式碼操作前，系統會先生成結構化的執行計劃
  * **智慧需求澄清** ：主動詢問使用者關於任務邏輯邊界和實現細節的問題，減少需求誤解
  * **可編輯計劃文件** ：自動生成`plan.md`檔案，允許使用者在執行前調整和最佳化步驟
  * **透明執行流程** ：讓使用者清楚瞭解系統將要執行的每一個操作和預期結果
  * **基於最新模型** ：充分利用Claude Opus 4.5的高階規劃和推理能力

### 2\. Plan Mode的工作流程

    bash


    ┌─────────────┐     ┌─────────────────┐     ┌─────────────────┐
    │ 用户提出需求 │────▶│ 启用Plan Mode   │────▶│ 智能需求澄清   │
    └─────────────┘     └─────────────────┘     └─────────────────┘
                                   ▲                      │
                                   │                      ▼
    ┌─────────────┐     ┌─────────────────┐     ┌─────────────────┐
    │ 任务完成    │◀────│ 执行计划       │◀────│ 生成/修改计划   │
    └─────────────┘     └─────────────────┘     └─────────────────┘

## Plan Mode的使用方法

### 1\. 启用Plan Mode


在Claude Code中啟用Plan Mode有三種便捷方式：

  * **快捷鍵操作** ：使用`Shift + Tab`快捷鍵快速切換
  * **介面按鈕** ：點選介面左下角的Plan Mode切換按鈕（顯示"plan"標識）
  * **命令列指令** ：在命令輸入框中輸入`/plan`命令

### 2\. Plan Mode的使用示例

# 示例：使用Plan Mode创建一个待办事项应用


**使用者請求** ： "建立一個簡單的待辦事項應用，包含新增、刪除和標記完成功能"

**Claude Code (Plan Mode) 智慧澄清** ：

```
    bash


    为了给您创建一个符合需求的待办事项应用，我需要了解一些具体细节：

    1. 您希望使用什么编程语言？(例如：Python, JavaScript, TypeScript)
    2. 是否需要特定的框架？(例如：React, Vue, Flask, Express)
    3. 数据存储方式？(本地JSON文件, 数据库, 内存)
    4. 用户界面类型？(命令行界面, Web界面, 桌面应用)
    5. 是否有其他特定功能需求？(如搜索、分类等)


**使用者回答** ： "使用JavaScript，不需要框架，本地JSON儲存，命令列介面"

**Claude Code (Plan Mode) 生成的plan.md** ：

    markdown


    # 待办事项应用实现计划

    ## 1. 项目结构
    - 创建项目根目录: `todo-app`
    - 创建主程序文件: `todo.js`
    - 创建数据存储文件: `todos.json`
    - 创建项目说明文档: `README.md`

    ## 2. 核心功能实现

    ### 2.1 数据管理模块
    - **loadTodos()**: 从JSON文件读取待办事项数据
    - **saveTodos(todos)**: 将待办事项数据保存到JSON文件
    - **initTodos()**: 初始化数据结构（如果文件不存在）

    ### 2.2 待办事项功能模块
    - **addTodo(todoText)**: 添加新的待办事项
    - **deleteTodo(index)**: 删除指定索引的待办事项
    - **toggleTodo(index)**: 切换待办事项的完成状态
    - **listTodos()**: 列出所有待办事项（区分已完成和未完成）

    ### 2.3 用户界面模块
    - **showMenu()**: 显示命令行菜单选项
    - **handleUserInput()**: 处理用户输入和命令执行
    - **run()**: 主程序循环，保持应用运行

    ## 3. 实现步骤

    1. 创建项目目录和基础文件结构
    2. 实现数据管理模块（文件读写功能）
    3. 实现待办事项核心功能
    4. 实现命令行用户界面
    5. 编写主程序入口和初始化逻辑
    6. 全面测试所有功能
    7. 编写项目说明文档

    ## 4. 预期文件结构

    ```

    todo-app/
    ├── todo.js          # 主程式檔案
    ├── todos.json       # 資料儲存檔案
    └── README.md        # 專案說明文件

    ```

    ## 5. 预期使用示例

    ```bash

    $ node todo.js
    1. 新增待辦事項

```
    2. 删除待办事项
    3. 标记完成/未完成
    4. 查看所有待办
    5. 退出
    请选择操作: 1
    请输入待办事项: 学习Claude Code Plan Mode
    待办事项已添加！


### 3\. 稽核和修改計劃


```

使用者可以稽核生成的`plan.md`檔案，並根據實際需求進行調整和最佳化。例如，新增新功能、調整實現順序或修改技術細節：

```
    markdown


    # 待办事项应用实现计划（修改后）

    ## 1. 项目结构
    - 创建项目根目录: `todo-app`
    - 创建主程序文件: `todo.js`
    - 创建数据存储文件: `todos.json`
    - 创建项目说明文档: `README.md`

    ## 2. 核心功能实现

    ### 2.1 数据管理模块
    - **loadTodos()**: 从JSON文件读取待办事项数据
    - **saveTodos(todos)**: 将待办事项数据保存到JSON文件
    - **initTodos()**: 初始化数据结构

    ### 2.2 待办事项功能模块
    - **addTodo(todoText)**: 添加新的待办事项
    - **deleteTodo(index)**: 删除指定索引的待办事项
    - **toggleTodo(index)**: 切换待办事项的完成状态
    - **listTodos()**: 列出所有待办事项
    - **clearCompleted()**: 清空所有已完成的待办事项  # 新增功能

    ### 2.3 用户界面模块
    - **showMenu()**: 显示命令行菜单选项
    - **handleUserInput()**: 处理用户输入和命令执行
    - **displayTodo(todo, index)**: 格式化显示单个待办事项  # 新增辅助函数
    - **run()**: 主程序循环

    ## 3. 实现步骤

    1. 创建项目目录和基础文件结构
    2. 实现数据管理模块
    3. 实现待办事项核心功能（包括新增的清空功能）
    4. 实现命令行用户界面（增强显示效果）
    5. 编写主程序入口
    6. 测试所有功能（重点测试新增功能）
    7. 编写详细的README文档

    ## 4. 预期文件结构

    ```

    todo-app/
    ├── todo.js          # 主程式檔案
    ├── todos.json       # 資料儲存檔案
    └── README.md        # 專案說明文件

    ```

    ## 5. 预期使用示例

    ```bash

    $ node todo.js
    1. 新增待辦事項

```
    2. 删除待办事项
    3. 标记完成/未完成
    4. 查看所有待办
    5. 清空已完成的待办事项
    6. 退出
    请选择操作: 1
    请输入待办事项: 学习Plan Mode
    待办事项已添加！


### 4\. 執行計劃


```

使用者確認並最佳化計劃後，Claude Code將按照計劃有序執行所有操作，並實時反饋進度：

```
    bash


    开始执行待办事项应用开发计划...

    1. 创建项目目录结构
    ✅ 创建目录: todo-app
    ✅ 创建文件: todo.js
    ✅ 创建文件: todos.json
    ✅ 创建文件: README.md

    2. 实现数据管理模块
    ✅ 实现 loadTodos() 函数
    ✅ 实现 saveTodos(todos) 函数
    ✅ 实现 initTodos() 函数

    3. 实现待办事项功能模块
    ✅ 实现 addTodo(todoText) 函数
    ✅ 实现 deleteTodo(index) 函数
    ✅ 实现 toggleTodo(index) 函数
    ✅ 实现 listTodos() 函数
    ✅ 实现 clearCompleted() 函数（新增）

    4. 实现用户界面模块
    ✅ 实现 showMenu() 函数
    ✅ 实现 handleUserInput() 函数
    ✅ 实现 displayTodo(todo, index) 函数（新增）
    ✅ 实现 run() 函数

    5. 编写主程序入口
    ✅ 编写主程序入口代码
    ✅ 实现应用初始化逻辑

    6. 测试所有功能
    ✅ 测试添加功能
    ✅ 测试删除功能
    ✅ 测试标记完成功能
    ✅ 测试列表功能
    ✅ 测试清空已完成功能
    ✅ 测试退出功能

    7. 编写README文档
    ✅ 编写项目说明
    ✅ 编写安装和使用说明
    ✅ 编写功能说明
    ✅ 编写代码结构说明

    计划执行完成！待办事项应用已成功创建。

## Plan Mode的优势

### 1\. 显著提高任务质量

```

Plan Mode透過結構化的規劃流程，大幅提升了程式設計任務的整體質量：

評估指標| 普通模式| Plan Mode| 提升幅度
---|---|---|---

需求理解準確率| 75%| 95%| +27%
功能覆蓋完整度| 80%| 98%| +22%
程式碼質量評分| 78%| 92%| +18%
任務完成時間效率| 基準| 提升30%| +30%

### 2\. 增強使用者控制能力


  * **完全可見性** ：使用者可以清晰瞭解系統將要執行的每一個操作和預期結果
  * **靈活可編輯性** ：使用者可以根據實際需求調整和最佳化執行計劃
  * **嚴格可稽核性** ：使用者可以在執行前全面審核計劃的合理性和完整性
  * **實時反饋** ：執行過程中提供清晰的進度和狀態反饋

### 3\. 大幅減少錯誤和風險

Plan Mode透過前置規劃和稽核機制，有效降低了程式設計任務的各類風險：

風險型別| 普通模式| Plan Mode| 風險降低幅度
---|---|---|---

需求誤解| 高| 低| 80% ↓
程式碼邏輯錯誤| 中| 低| 60% ↓
資料丟失風險| 中| 低| 70% ↓
功能遺漏| 高| 低| 85% ↓

## Plan Mode的应用场景

### 1\. 复杂项目开发


對於結構複雜、涉及多個模組和技術棧的專案，Plan Mode可以：

  * 幫助使用者清晰規劃專案架構和模組劃分
  * 有序組織開發步驟和依賴關係
  * 確保所有功能點完整實現
  * 提高團隊協作效率（透過共享和討論計劃）

### 2\. 關鍵程式碼修改

對於需要修改核心程式碼、敏感資料或生產環境程式碼的任務，Plan Mode可以：

  * 降低誤操作和破壞性修改的風險
  * 提供詳細的修改計劃作為回滾參考
  * 確保修改符合系統架構和設計原則
  * 便於程式碼審查和質量控制

### 3\. 學習和教學場景

對於學習程式設計的使用者和教育場景，Plan Mode可以：

  * 展示完整的軟體開發流程和最佳實踐
  * 解釋每一步執行的邏輯和技術原理
  * 幫助培養結構化思維和規劃能力
  * 提供清晰的學習路徑和實踐指導

### 4\. 批次資料處理

對於需要處理大量資料的任務，Plan Mode可以：

  * 規劃高效的資料處理流程
  * 設計並行處理策略提高效率
  * 確保資料安全和完整性
  * 提供處理進度和結果驗證機制

## Plan Mode与其他功能的结合

### 1\. 与子Agent功能结合


Plan Mode可以與Claude Code的子Agent功能無縫結合，為複雜任務生成包含多Agent協作的詳細計劃：

```
    markdown


    # 复杂Web应用开发计划

    ## 1. 项目概述
    开发一个包含前端、后端和数据库的完整Web应用

    ## 2. 项目结构
    - 前端目录: `frontend/` (React + TypeScript)
    - 后端目录: `backend/` (Node.js + Express)
    - 数据库目录: `database/` (PostgreSQL)

    ## 3. 子Agent分配与协作

    ### 3.1 前端开发子Agent
    - **负责范围**: 用户界面实现、交互逻辑、响应式设计
    - **技术栈**: React 18 + TypeScript + Tailwind CSS
    - **交付物**: 完整的前端应用、组件文档

    ### 3.2 后端开发子Agent
    - **负责范围**: API服务、业务逻辑、用户认证
    - **技术栈**: Node.js + Express + JWT
    - **交付物**: 完整的后端服务、API文档

    ### 3.3 数据库设计子Agent
    - **负责范围**: 数据模型设计、关系映射、查询优化
    - **技术栈**: PostgreSQL + Prisma ORM
    - **交付物**: 数据库设计文档、迁移脚本

    ## 4. 协作流程

    1. 前端子Agent设计UI原型和组件结构
    2. 数据库子Agent设计数据模型和关系
    3. 后端子Agent实现API接口
    4. 前端子Agent集成API并实现完整交互
    5. 进行系统集成测试和调试
    6. 性能优化和部署配置

    ## 5. 时间线规划

    - 第1-2天: 需求分析和设计
    - 第3-5天: 并行开发（前端、后端、数据库）
    - 第6天: 系统集成和测试
    - 第7天: 优化和部署

### 2\. 与异步任务功能结合

```

Plan Mode可以為非同步任務生成包含並行執行步驟的最佳化計劃：

```
    markdown


    # 大规模用户数据处理计划

    ## 1. 任务概述
    处理100万条用户数据，包括清洗、转换和分析

    ## 2. 执行步骤

    ### 2.1 数据准备阶段
    - 下载原始数据文件: `users_raw.csv`
    - 验证文件完整性和格式
    - 创建数据备份

    ### 2.2 并行处理阶段（提高效率）
    - **数据清洗任务**: `clean_data.js` (线程1) - 处理缺失值和格式问题
    - **数据转换任务**: `transform_data.js` (线程2) - 标准化数据格式
    - **数据验证任务**: `validate_data.js` (线程3) - 确保数据一致性

    ### 2.3 结果整合阶段
    - 合并三个线程的处理结果
    - 生成详细的数据分析报告
    - 保存最终处理后的数据

    ## 3. 资源配置

    - 分配3个CPU核心用于并行处理
    - 设置1GB内存限制/线程
    - 预计处理时间: 25-30分钟

    ## 4. 风险控制

    - 每个处理步骤都创建中间备份
    - 实现错误重试机制
    - 设置超时监控和警报

## 总结

```

Plan Mode是Claude Code的一項革命性功能，它透過以下方式徹底改變了AI輔助程式設計的體驗：

  1. **智慧規劃引擎** ：利用Claude Opus 4.5的高階推理能力生成結構化執行計劃
  2. **需求澄清機制** ：主動詢問關鍵細節，大幅減少需求誤解
  3. **使用者可控性** ：提供可編輯的計劃文件，讓使用者掌握完全的控制權
  4. **透明執行流程** ：從計劃到執行的全過程可見，減少"黑盒操作"的不確定性
  5. **多場景適用性** ：從簡單指令碼到複雜系統開發，從學習到生產環境都能發揮價值
  6. **無縫功能整合** ：與子Agent、非同步任務等高階功能完美結合，支援複雜任務處理

透過Plan Mode，Claude Code將AI輔助程式設計從"簡單執行指令"提升到"智慧協作夥伴"的層次，為開發者提供了更加可靠、高效和可控的程式設計體驗。無論是個人開發還是團隊協作，Plan Mode都能幫助使用者以更高的質量、更低的風險完成程式設計任務。

在下一節中，我們將探討Claude Code的另一個高階功能：Interview Mode。
