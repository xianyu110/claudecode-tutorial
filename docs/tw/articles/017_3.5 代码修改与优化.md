# 3.5 程式碼修改與最佳化

## 3.5.1 概述
Claude Code 不僅能夠從零開始生成高質量程式碼，更擅長對現有程式碼進行智慧修改與深度最佳化。透過程式碼修改功能，你可以快速實現函式重新命名、引數調整、結構重構等需求；而最佳化功能則能幫助你提升程式碼效能、增強可讀性、修復潛在問題。掌握這些能力，將顯著提升你的開發效率和程式碼質量。

```
## 3.5.2 代码修改

### 3.5.2.1 修改简单代码

```
對於基礎程式碼修改任務，Claude Code 能夠精準識別並完成變更。常見場景包括函式重新命名、變數名調整、簡單邏輯修改等。

**示例：函式重新命名**

**輸入** ：

```javascript
    bash


    修改这段 JavaScript 代码，将函数名从 add 改为 sum：
    function add(a, b) {
        return a + b;
    }

```
**輸出** ：

```javascript
    javascript


    function sum(a, b) {
        return a + b;
    }

### 3.5.2.2 修改复杂代码

```
對於包含複雜邏輯的程式碼，Claude Code 能夠理解上下文並進行深度修改。常見場景包括新增型別註解、重構條件分支、最佳化錯誤處理等。

**示例：新增型別註解**

**輸入** ：

```python
    bash


    修改这段 Python 代码，添加类型注解：
    def calculate_area(shape, **kwargs):
        if shape == "circle":
            return 3.14159 * kwargs["radius"] ** 2
        elif shape == "rectangle":
            return kwargs["width"] * kwargs["height"]
        elif shape == "triangle":
            return 0.5 * kwargs["base"] * kwargs["height"]
        else:
            raise ValueError(f"Unknown shape: {shape}")

```
**輸出** ：

```python
    python


    from typing import Dict, Union, Any

    def calculate_area(shape: str, **kwargs: Dict[str, Union[int, float]]) -> Union[float, int]:
        """
        计算不同形状的面积

        参数:
        shape: str - 形状类型，可以是 "circle", "rectangle", 或 "triangle"
        **kwargs: Dict[str, Union[int, float]] - 形状的参数
            - 对于圆形: 需要 "radius" 参数
            - 对于矩形: 需要 "width" 和 "height" 参数
            - 对于三角形: 需要 "base" 和 "height" 参数

        返回:
        Union[float, int] - 计算出的面积

        异常:
        ValueError - 当形状类型未知时抛出
        """
        if shape == "circle":
            if "radius" not in kwargs:
                raise ValueError("Circle requires 'radius' parameter")
            return 3.14159 * kwargs["radius"] ** 2
        elif shape == "rectangle":
            if "width" not in kwargs or "height" not in kwargs:
                raise ValueError("Rectangle requires 'width' and 'height' parameters")
            return kwargs["width"] * kwargs["height"]
        elif shape == "triangle":
            if "base" not in kwargs or "height" not in kwargs:
                raise ValueError("Triangle requires 'base' and 'height' parameters")
            return 0.5 * kwargs["base"] * kwargs["height"]
        else:
            raise ValueError(f"Unknown shape: {shape}")

### 3.5.2.3 修改代码结构

```
Claude Code 能夠理解程式碼的整體結構，並進行大規模重構。常見場景包括回撥函式轉 Promise、類結構調整、模組化拆分等。

**示例：回撥函式轉 Promise**

**輸入** ：

```javascript
    bash


    重构这段 JavaScript 代码，将回调函数改为 Promise：
    function fetchData(url, callback) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.onload = () => {
            if (xhr.status === 200) {
                callback(null, JSON.parse(xhr.responseText));
            } else {
                callback(new Error(`Request failed with status ${xhr.status}`));
            }
        };
        xhr.onerror = () => {
            callback(new Error('Network error'));
        };
        xhr.send();
    }

```
**輸出** ：

```javascript
    javascript


    function fetchData(url) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url);
            xhr.onload = () => {
                if (xhr.status === 200) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        resolve(data);
                    } catch (error) {
                        reject(new Error(`Failed to parse JSON: ${error.message}`));
                    }
                } else {
                    reject(new Error(`Request failed with status ${xhr.status}`));
                }
            };
            xhr.onerror = () => {
                reject(new Error('Network error'));
            };
            xhr.send();
        });
    }

## 3.5.3 代码优化

### 3.5.3.1 性能优化

```
Claude Code 能夠識別效能瓶頸並提供最佳化建議。常見場景包括迴圈最佳化、記憶體洩漏修復、演算法複雜度降低等。

**示例：迴圈最佳化**

**輸入** ：

```python
    bash


    优化这段 Python 代码的性能：
    def find_duplicates(lst):
        duplicates = []
        for i in range(len(lst)):
            for j in range(i + 1, len(lst)):
                if lst[i] == lst[j] and lst[i] not in duplicates:
                    duplicates.append(lst[i])
        return duplicates

```
**輸出** ：

```python
    python


    def find_duplicates(lst):
        seen = set()
        duplicates = set()
        for item in lst:
            if item in seen:
                duplicates.add(item)
            else:
                seen.add(item)
        return list(duplicates)

### 3.5.3.2 可读性优化

```
良好的程式碼可讀性是團隊協作和長期維護的基礎。Claude Code 能夠最佳化程式碼結構、新增註釋、統一命名規範，提升程式碼的可理解性。

**示例：提升程式碼可讀性**

**輸入** ：

```python
    bash


    优化这段代码的可读性：
    def calc(a,b,c):
        if a>b:
            return a*c
        else:
            return b/c

```
**輸出** ：

```python
    python


    def calculate_result(value_a: float, value_b: float, multiplier: float) -> float:
        """
        根据输入值计算结果

        如果 value_a 大于 value_b，返回 value_a 乘以 multiplier
        否则返回 value_b 除以 multiplier

        参数:
        value_a: 第一个比较值
        value_b: 第二个比较值
        multiplier: 乘法因子

        返回:
        计算结果
        """
        if value_a > value_b:
            return value_a * multiplier
        else:
            return value_b / multiplier

### 3.5.3.3 安全性优化

```
Claude Code 能夠識別常見的安全漏洞並提供修復方案。常見場景包括 SQL 注入防護、XSS 攻擊防範、輸入驗證增強等。

**示例：SQL 注入防護**

**輸入** ：

```python
    bash


    修复这段 Python 代码的 SQL 注入漏洞：
    def get_user(username):
        cursor.execute(f"SELECT * FROM users WHERE username = '{username}'")
        return cursor.fetchone()

```
**輸出** ：

```python
    python


    def get_user(username):
        cursor.execute("SELECT * FROM users WHERE username = %s", (username,))
        return cursor.fetchone()

## 3.5.4 最佳实践

### 3.5.4.1 明确修改范围

```
在請求程式碼修改時，儘可能明確修改範圍和目標。例如：

  * ✅ "將函式名從 `fetchData` 改為 `getUserData`，並保持功能不變"
  * ❌ "修改這段程式碼"

### 3.5.4.2 提供上下文
對於複雜程式碼修改，提供足夠的上下文資訊有助於 Claude Code 做出更準確的修改。例如：

  * "這段程式碼用於處理使用者登入，需要新增驗證碼驗證步驟"
  * "這個函式的效能瓶頸在於迴圈巢狀，需要最佳化時間複雜度"

### 3.5.4.3 分階段修改
對於大規模程式碼變更，建議分階段進行：

  1. 先完成核心功能修改
  2. 再進行效能最佳化
  3. 最後新增文件和測試

### 3.5.4.4 驗證修改結果
在接受 Claude Code 的修改建議後，務必進行驗證：

  * 執行測試用例確保功能正常
  * 檢查程式碼風格一致性
  * 確認效能提升效果

透過以上實踐，你將能夠充分發揮 Claude Code 在程式碼修改與最佳化方面的能力，顯著提升開發效率和程式碼質量。