# 5.3 `claude -p "query"` - 通过 SDK 查询，然后退出

`claude -p "query"` 命令允许您通过 SDK 执行查询，然后立即退出。这是非交互模式，适合脚本和自动化场景。

```
## 命令语法

    bash


    claude -p "query" [选项]

## 功能描述

```
使用 `-p`（`--print`）标志，Claude Code 会：

  1. 处理您提供的查询
  2. 通过 SDK 执行查询
  3. 打印响应结果
  4. 立即退出，不进入交互模式

这是程序化使用 Claude Code 的主要方式，特别适合：

  * 脚本和自动化
  * CI/CD 流程
  * 批处理任务
  * 集成到其他工具

```
## 使用示例

### 基本用法

    bash


    claude -p "解释这个函数"

```
执行查询，打印结果，然后退出。

```
### 代码生成

    bash


    claude -p "创建一个快速排序算法的 Python 实现"

```
生成快速排序算法代码，打印结果，然后退出。

```
### 代码分析

    bash


    claude -p "分析这段代码的时间复杂度"

```
分析代码的时间复杂度，打印结果，然后退出。

```
### 处理管道内容

    bash


    cat logs.txt | claude -p "解释这些日志"

```
将日志文件内容通过管道传递给 Claude Code，请求解释，然后退出。

```
### 结合输出格式

    bash


    claude -p "分析这个项目" --output-format json

```
以 JSON 格式输出分析结果，便于脚本解析。

## 输出格式
`-p` 标志支持多种输出格式，可以通过 `--output-format` 标志指定：

```
### text 格式（默认）

    bash


    claude -p "查询内容"

```
输出纯文本格式的响应。

```
### json 格式

    bash


    claude -p "查询内容" --output-format json

```
输出 JSON 格式的响应，便于程序解析。

```
### stream-json 格式

    bash


    claude -p "查询内容" --output-format stream-json

```
输出流式 JSON，可以实时处理响应。

```bash
## 使用场景

### 1\. 脚本自动化

    bash


    #!/bin/bash

    # 获取代码审查结果
    result=$(claude -p "审查 src/main.js" --output-format json)
    # 处理结果
    echo "$result" | jq '.suggestions'

```
在脚本中使用 Claude Code 进行代码审查。

```bash
### 2\. CI/CD 集成

    yaml


    # GitHub Actions 示例
    - name: Code Review
      run: |
        review=$(claude -p "审查最近的代码变更" --output-format json)
        echo "$review" > review.json

```
在 CI/CD 流程中自动进行代码审查。

```
### 3\. 批处理

    sh


    for file in *.js; do
      claude -p "优化 $file" > "${file%.js}.optimized.js"
    done

```
批量处理多个文件。

```
## 高级用法

### 跳过权限提示

    bash


    claude -p --dangerously-skip-permissions "任务"

```
跳过权限提示（谨慎使用），完全自动化执行。

## 注意事项
  1. **非交互模式** ：`-p` 标志不会进入交互模式，执行完查询后立即退出
  2. **输出格式** ：建议使用 `--output-format json` 便于脚本解析
  3. **错误处理** ：脚本中应该处理可能的错误和异常
  4. **API 限制** ：频繁调用可能触发 API 速率限制

## 与交互模式的对比
特性| 交互模式| 打印模式（-p）
---|---|---
会话保持| 是| 否
多轮对话| 是| 否
上下文保持| 是| 否
脚本友好| 否| 是
自动化支持| 有限| 优秀
实时交互| 是| 否

## 最佳实践
  1. **使用 JSON 输出** ：便于脚本解析和处理
  2. **错误处理** ：在脚本中添加错误处理逻辑
  3. **结果验证** ：验证返回的结果是否符合预期
  4. **日志记录** ：记录查询和结果，便于调试和审计

## 相关命令
  * `claude`：启动交互式 REPL
  * `claude "query"`：使用初始提示启动 REPL
  * `claude -c`：继续最近的对话
  * `--output-format`：指定输出格式

## SDK 文档
有关程序化使用 Claude Code 的更多详情，请参阅官方 SDK 文档。